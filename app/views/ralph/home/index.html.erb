<h1>Ralph Database Viewer</h1>

<div style="background: #e8f4ff; padding: 15px; border-radius: 6px; margin-bottom: 20px; border-left: 4px solid #0366d6;">
  <h2 style="margin-top: 0; font-size: 18px;">ðŸ“Š Issues Overview</h2>
  <p style="margin-bottom: 10px;">View hierarchical issue tracking with design documents and pull requests. Drill down into any issue to see its subtree.</p>
  <%= link_to "View Issues â†’", ralph_issue_assignments_path(project_id: params[:project_id]), style: "color: #0366d6; font-weight: 600; text-decoration: none;" %>
</div>

<%= turbo_stream_from "ralph_metrics" %>

<%= turbo_frame_tag "live_metrics", style: "display: block; margin-bottom: 20px;" do %>
  <%= render "metrics", metrics: {
    total_issues: Ralph::IssueAssignment.count,
    root_issues: Ralph::IssueAssignment.where(parent_issue_id: nil).count,
    open_prs: Ralph::PullRequest.where.not(state: "merged").count,
    design_docs: Ralph::DesignDocument.count
  } %>
<% end %>

<p>Browse the Ralph database tables below:</p>

<ul>
  <% @models.each do |model| %>
    <li>
      <%= link_to model.humanize, ralph_models_path(project_id: params[:project_id], model_name: model) %>
    </li>
  <% end %>
</ul>
