<h1><%= @model_name.singularize.humanize %> #<%= @record.id %></h1>

<p>
  <%= link_to "← Back to #{@model_name.humanize}", ralph_model_path(model_name: @model_name) %> |
  <%= link_to "← Back to Ralph Home", ralph_root_path %>
</p>

<% if @model_name == "pull_requests" && @record.github_pr_number %>
  <div class="pr-info-section" style="margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 4px; background: #f9f9f9;">
    <h2 style="margin-top: 0;">Pull Request Information</h2>
    <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
      <% if @record.url %>
        <%= link_to "PR ##{@record.github_pr_number}", @record.url, target: "_blank", rel: "noopener noreferrer", class: "pr-link-badge", style: "font-weight: bold; font-size: 1.1em;" %>
      <% else %>
        <span style="font-weight: bold;">PR #<%= @record.github_pr_number %></span>
      <% end %>

      <%= pr_state_badge(@record.state) %>

      <% if @pr_check_status %>
        <%= ci_status_badge(@pr_check_status[:status]) %>

        <% merge_badge = merge_conflict_badge(@pr_check_status[:mergeable], @pr_check_status[:mergeable_state]) %>
        <%= merge_badge if merge_badge %>
      <% end %>

      <% if @record.unresolved_comments_count && @record.unresolved_comments_count > 0 %>
        <span class="badge" style="background: #ff9800; color: white; padding: 4px 8px; border-radius: 3px;">
          ⚠️ <%= @record.unresolved_comments_count %> unresolved comment<%= @record.unresolved_comments_count > 1 ? 's' : '' %>
        </span>
      <% end %>
    </div>

    <% if @record.title.present? %>
      <p style="margin-top: 10px; margin-bottom: 5px;"><strong>Title:</strong> <%= @record.title %></p>
    <% end %>
  </div>
<% end %>

<table border="1" cellpadding="10" cellspacing="0">
  <tbody>
    <% @record.attributes.each do |attr, value| %>
      <tr>
        <th style="text-align: right;"><%= attr.humanize %></th>
        <td>
          <% if value.is_a?(Time) || value.is_a?(ActiveSupport::TimeWithZone) %>
            <%= value.strftime("%Y-%m-%d %H:%M:%S %Z") %>
          <% elsif value.is_a?(String) && value.length > 500 %>
            <pre style="white-space: pre-wrap; word-wrap: break-word; max-width: 800px;"><%= value %></pre>
          <% elsif value.nil? %>
            <em>nil</em>
          <% else %>
            <%= value %>
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<% # Display associations if they exist %>
<% if @record.class.reflect_on_all_associations.any? %>
  <h2>Associations</h2>
  <ul>
    <% @record.class.reflect_on_all_associations.each do |association| %>
      <li>
        <strong><%= association.name.to_s.humanize %>:</strong>
        <% begin %>
          <% related = @record.send(association.name) %>
          <% if related.is_a?(ActiveRecord::Relation) || related.is_a?(Array) %>
            <%= related.count %> record(s)
            <% model_key = Ralph::ModelsController::ALLOWED_MODELS.key(related.klass) %>
            <% if model_key %>
              - <%= link_to "View all", ralph_model_path(model_name: model_key) %>
            <% end %>
          <% elsif related %>
            ID: <%= related.id %>
            <% model_key = Ralph::ModelsController::ALLOWED_MODELS.key(related.class) %>
            <% if model_key %>
              - <%= link_to "View", ralph_model_record_path(model_name: model_key, id: related.id) %>
            <% end %>
          <% else %>
            <em>none</em>
          <% end %>
        <% rescue => e %>
          <em>Error loading association: <%= e.message %></em>
        <% end %>
      </li>
    <% end %>
  </ul>
<% end %>
